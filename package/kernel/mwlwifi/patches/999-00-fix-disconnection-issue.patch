From 64fb594284bfdd08011a33dde23347eee84955ba Mon Sep 17 00:00:00 2001
From: jbsky <webmaster@jbsky.fr>
Date: Sat, 22 Apr 2023 22:33:33 +0200
Subject: [PATCH 18/18] fix disconnection issue see
 https://github.com/kaloz/mwlwifi/issues/409

---
 mac80211.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/mac80211.c b/mac80211.c
index e464556..b8da691 100644
--- a/mac80211.c
+++ b/mac80211.c
@@ -558,7 +558,8 @@ static int mwl_mac80211_set_key(struct ieee80211_hw *hw,
 		}
 	} else {
 		rc = mwl_fwcmd_encryption_remove_key(hw, vif, addr, key);
-		mwl_vif->is_hw_crypto_enabled = false;
+		if (vif->type == NL80211_IFTYPE_STATION)
+			mwl_vif->is_hw_crypto_enabled = false;
 		if (rc)
 			goto out;
 	}
-- 
2.40.0

